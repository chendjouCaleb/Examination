<app-test-layout [title]="'Groupe &#8226; ' + testGroup.group.name">

  <div class="d-flex justify-content-between align-items-center my-2">
    <div class="ms-fontSize-24">{{testGroup.test.name}} / {{testGroup.group.name | ucFirst}}</div>
    <div class="text-right">
      <MsfButton *ngIf="testGroup.waiting" (click)="service.start(testGroup)" theme="success" Icon="Clock">Débuter
      </MsfButton>
      <MsfButton *ngIf="testGroup.finished" (click)="service.restart(testGroup)" class="ml-2" theme="success"
                 Icon="Rotate90Clockwise">Redémarrer
      </MsfButton>
      <MsfButton *ngIf="testGroup.progress" (click)="service.end(testGroup)" class="ml-2" theme="error" Icon="Lock">
        Arrêter
      </MsfButton>
    </div>
  </div>

  <div class="ms-description-list">
    <dl>
      <dt>État</dt>
      <dd><span [appStateBadge]="testGroup.state"></span></dd>
    </dl>

    <dl *ngIf="testGroup.progress">
      <dt>Heure de début</dt>
      <dd>{{testGroup.startHour}}</dd>
    </dl>

    <dl *ngIf="testGroup.finished">
      <dt>Éffectué le</dt>
      <dd msColor="sharedBlue10">{{testGroup.startDate | date}} de {{testGroup.startHour}} à {{testGroup.endHour}}</dd>
    </dl>

    <dl>
      <dt>Salle</dt>
      <dd>{{testGroup.room.name}}</dd>
    </dl>

  </div>


  <div class=" mt-3" style="display: grid; grid-template-columns: 1fr 1fr 1fr; grid-column-gap: 6px;">
    <app-testGroupSupervisorList [testGroup]="testGroup"></app-testGroupSupervisorList>
    <app-testGroupCorrectorList class="ml-4" [testGroup]="testGroup"></app-testGroupCorrectorList>
    <app-testGroupSecretaryList class="ml-4" [testGroup]="testGroup"></app-testGroupSecretaryList>
  </div>


  <div class="mt-3">
    <div class="d-flex justify-content-between align-items-center my-2">
      <div class="ms-fontSize-24">Partipants</div>
      <div class="text-right">
        <MsfButton Icon="Add" theme="primary" (click)="addPapers()">Ajouter les étudiants</MsfButton>
      </div>
    </div>

    <MsfTable *ngIf="papers">
      <MsfTableHead>
        <MsfTableHeadCell>#</MsfTableHeadCell>
        <MsfTableHeadCell sortBy="index">N°</MsfTableHeadCell>
        <MsfTableHeadCell>Matricule</MsfTableHeadCell>
        <MsfTableHeadCell sortBy="fullName">Nom & prénom</MsfTableHeadCell>
        <MsfTableHeadCell>Heure d'arrivée</MsfTableHeadCell>
        <MsfTableHeadCell>Heure de départ</MsfTableHeadCell>
        <MsfTableHeadCell></MsfTableHeadCell>
      </MsfTableHead>

      <MsfTableRow #row *ngFor="let item of papers" [value]="item">
        <MsfTableCell> {{row.index + 1}}</MsfTableCell>
        <MsfTableCell> {{item.student.groupIndex + 1}}</MsfTableCell>
        <MsfTableCell> {{item.student.registrationId}}</MsfTableCell>
        <MsfTableCell> {{item.student.fullName}}</MsfTableCell>

        <MsfTableCell>
          <app-icon icon="Cancel" bgColor="sharedRed10" *ngIf="!item.isPresent"></app-icon>
          <ng-container *ngIf="item.isPresent">{{item.startHour}}</ng-container>
        </MsfTableCell>

        <MsfTableCell>
          <app-icon icon="Cancel" bgColor="sharedRed20" *ngIf="!item.isPresent"></app-icon>
          <ng-container *ngIf="item.isPresent && item.endDate">{{item.endHour}}</ng-container>
        </MsfTableCell>
        <MsfTableCell class="text-right">
          <MsfIconButton *ngIf="item.finished" (click)="paperService.scores(item)" [rounded]="true"
                         icon="EditNote" theme="primary"></MsfIconButton>

          <MsfIconButton *ngIf="!item.isPresent" (click)="paperService.changePresentState(item)" [rounded]="true"
                         icon="AddFriend" theme="primary"></MsfIconButton>

          <MsfIconButton *ngIf="item.progress" (click)="paperService.collect(item)" [rounded]="true"
                         icon="BlockContact" theme="warning" class="ml-2"></MsfIconButton>

          <MsfIconButton *ngIf="item.isPresent && testGroup.finished" (click)="paperService.report(item)"
                         [rounded]="true" icon="CheckMark" class="ml-2"></MsfIconButton>

          <MsfIconButton [rounded]="true" icon="MoreVertical" class="ml-2" [MsfMenuTrigger]="more"></MsfIconButton>

          <MsfIconButton (click)="paperService.details(item)" [rounded]="true" class="ml-2"
                         icon="RedEye" theme="primary"></MsfIconButton>

          <MsfMenu #more>

            <MsfMenuItem *ngIf="item.finished" icon="EditNote"
                         (click)="paperService.scores(item)">Noter
            </MsfMenuItem>

            <MsfMenuItem *ngIf="!item.isPresent && !testGroup.finished" icon="AddFriend"
                         (click)="paperService.changePresentState(item)">Admettre cet étudiant
            </MsfMenuItem>

            <MsfMenuItem *ngIf="item.progress" (click)="paperService.collect(item)"
                           icon="BlockContact" theme="warning"> Récuperer la copie</MsfMenuItem>


            <MsfMenuItem *ngIf="item.isPresent && testGroup.finished" icon="CheckMark"
                         (click)="paperService.report(item)">Consigner la copie
            </MsfMenuItem>

            <MsfMenuItem *ngIf="!testGroup.test.isClosed" icon="CommentAdd"
                         (click)="paperService.supervisorComment(item)">Commentaire de surveillance
            </MsfMenuItem>

            <MsfMenuItem *ngIf="item.isPresent && !testGroup.test.isClosed" icon="UserRemove" theme="error"
                         (click)="paperService.changePresentState(item)">Enlever cet étudiant
            </MsfMenuItem>

            <MsfMenuItem *ngIf="item.isPresent && item.finished && !testGroup.test.isClosed"
                         icon="CalendarSettingsMirrored" (click)="paperService.editDates(item)">
              Changer l'horaire de composition
            </MsfMenuItem>

          </MsfMenu>
        </MsfTableCell>
      </MsfTableRow>


    </MsfTable>
  </div>


</app-test-layout>
