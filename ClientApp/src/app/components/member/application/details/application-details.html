﻿
<div class="p-3" style="background-color: var(--cardBackgroundColor)">
  <div class="ms-pageTitle px-0" >
    <div>
      <div class="ms-fontSize-20 ">
        Demande
        <app-icon *ngIf="application.isAuthor" class="ml-1" icon="Contact"></app-icon>
      </div>

      <div>
        <span [appStateBadge]="application.state"></span>
      </div>
    </div>

    <div class="text-right">
      <ng-container *ngIf=" application.waiting">
        <MsfButton Icon="CheckMark" theme="success" (click)="accept()">Accepter</MsfButton>
        <MsfButton Icon="UserRemove" theme="error" class="ml-2" (click)="reject()">Rejeter</MsfButton>
      </ng-container>

      <ng-container *ngIf="application.isAuthor && application.waiting">
        <MsfButton [MsfMenuTrigger]="more" Icon="Edit" LeftIcon="ChevronDown" theme="primary" class="ml-2">Modifier
        </MsfButton>

        <MsfMenu #more>
          <MsfMenuItem icon="Contact" (click)="_applicationService.edit(application)">Modifier les informations
          </MsfMenuItem>

        </MsfMenu>
      </ng-container>

      <MsfButton *ngIf="application.isAuthor" Icon="Delete" [outline]="true" (click)="delete()" theme="error"
                 class="ml-2">Supprimer
      </MsfButton>

      <MsfIconButton icon="Cancel" class="ml-2" MsfModalClose>Fermer</MsfIconButton>
    </div>

  </div>

  <msAlert class="mt-3" theme="severeWarning" *ngIf="registrationIdIsUsed">
    Le matricule utilisé par cette demande est déjà utilisé par un autre étudiant de l'établissement!
  </msAlert>


  <div class="d-flex mt-5">
    <div class="ms-description-list">
      <dl>
        <dt>Nom & prénom</dt>
        <dd>{{application.fullName}}</dd>
      </dl>

      <dl>
        <dt>Matricule</dt>
        <dd>{{application.registrationId}}</dd>
      </dl>

      <dl>
        <dt>Date de naissance</dt>
        <dd>{{application.birthDate | date}}</dd>
      </dl>

      <dl>
        <dt>Genre</dt>
        <dd> {{application.gender}} </dd>
      </dl>

      <dl>
        <dt>Départment</dt>
        <dd>{{application.level.department.name}}</dd>
      </dl>
      <dl>
        <dt>Niveau</dt>
        <dd>{{application.level.index + 1}}</dd>
      </dl>

      <dl>
        <dt>Spécialité</dt>
        <dd *ngIf="application.levelSpeciality">{{application.levelSpeciality.speciality.name}}</dd>
        <dd *ngIf="!application.levelSpeciality">
          <span class="ms-badge ms-badge-error">Aucune</span>
        </dd>
      </dl>

    </div>

    <div class="ms-description-list ml-5">
      <dl>
        <dt>Date d'envoie</dt>
        <dd>{{application.registrationDate | amCalendar}}</dd>
      </dl>
      <dl>
        <dt>Envoyée par</dt>
        <dd>
          <MsfPersona *ngIf="application.user" size="size32">
            <MsfPersonaFigure text="{{application.user.fullName}}"></MsfPersonaFigure>
            <MsfPersonaText>
              <div class="ms-fontWeight-semibold">{{application.user.fullName}}</div>
              <div class="ms-fontSize-12 ms-fontWeight-light">@{{application.user.username}}</div>
            </MsfPersonaText>
          </MsfPersona>
        </dd>
      </dl>

      <dl>
        <dt>{{'état' | ucFirst}}</dt>
        <dd>
          <span [appStateBadge]="application.state"></span>
        </dd>
      </dl>

      <dl *ngIf="application.processDate">
        <dt>Date de traitement</dt>
        <dd>{{application.processDate | amCalendar}}</dd>
      </dl>

      <dl *ngIf="application.processDate">
        <dt>Traitée par</dt>
        <dd>
          <MsfPersona *ngIf="application.processUser" size="size32">
            <MsfPersonaFigure text="{{application.processUser.fullName}}"></MsfPersonaFigure>
            <MsfPersonaText>
              <div class="ms-fontWeight-semibold">{{application.processUser.fullName}}</div>
              <div class="ms-fontSize-12 ms-fontWeight-light"> @{{application.processUser.username}}</div>
            </MsfPersonaText>
          </MsfPersona>
        </dd>
      </dl>

    </div>


  </div>

</div>
